/*------------------------------------------------------------------------
 * Copyright (c) 2014 hailiang All rights reserved. by Jackal
------------------------------------------------------------------------*/
var tips =3,lvtype,gameoverpic,answer,say,curlv;
var _config = {
	color: {
		allTime: 60,
		addTime: 2,
		lvMap: [3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4]
	}
},
	shareData = {
		imgUrl: "http://jackal.sinaapp.com/ds/assets/img/share_ico.jpg",
		timeLineLink: "http://jackal.sinaapp.com/ds",
		tTitle: "快，抓住那小三",
		tContent: ""
	};
!
function() {
	var fdj;	
	var a = $("#box"),
		b = {
			lv: $("#room .lv em"),
			lvtype: $("#room .lvtype"),
			time: $("#room .time"),
			start: $("#dialog .btn-restart"),
			back: $("#dialog .btn-back"),
			share: $("#dialog .btn-share"),
			pause: $("#room .btn-pause"),
			resume: $("#dialog .btn-resume"),
			dialog: $("#dialog"),
			d_content: $("#dialog .content"),
			d_pause: $("#dialog .pause"),
			d_gameover: $("#dialog .gameover")
		},
		c = {
			init: function(a, b, c) {
				this.type = a, this.api = API[a], this.config = _config[a], this.reset(), this.parent = c, this.el = b, this.renderUI(), this.inited || this.initEvent(), this.inited = !0, this.start()
			},
			renderUI: function() {
				var b = 90 == window.orientation || -90 == window.orientation,
					c = b ? window.innerHeight : window.innerWidth;
				c -= 20, c = Math.min(c, 500), a.width(c).height(c), this.el.show()
			},
			initEvent: function() {
				var d = "ontouchstart" in document.documentElement ? "touchend" : "click",
					e = this;
				$(window).resize(function() {
					c.renderUI();
				}), a.on(d, "span", function() {
					var a = $(this).data("type");
					if("a"==a){
						e.nextLv.call(e);
					}else{
   						 e.gameOver(e);
					}
					
				}), b.pause.on(d, _.bind(this.pause, this)), b.resume.on(d, _.bind(this.resume, this)), b.start.on(d, _.bind(this.start, this)), b.back.on(d, _.bind(this.back, this)), b.share.on(d, _.bind(this.share, this))
			},
			start: function() {
				this.time > 5 && b.time.removeClass("danger"), b.dialog.hide(), this._pause = !1, this.lv = "undefined" != typeof this.lv ? this.lv + 1 : 0, this.lvMap = this.config.lvMap[this.lv] || _.last(this.config.lvMap), this.renderMap(), this.renderInfo(), this.timer || (this.timer = setInterval(_.bind(this.tick, this), 1e3))
			},
			share: function() {},
			resume: function() {
				b.dialog.hide(), this._pause = !1
			},
			pause: function() {
				this._pause = !0, b.d_content.hide(), b.d_pause.show(), b.dialog.show()
			},
			tick: function() {
				return this._pause ? void 0 : (this.time--, this.time < 6 && b.time.addClass("danger"), this.time < 0 ? void this.gameOver() : void b.time.text(parseInt(this.time)))
			},
			renderMap: function() {
				if (!this._pause) {
					var b = this.lvMap * this.lvMap,
						c = "",
						d = "lv" + this.lvMap;
					_(b).times(function() {
						c += "<span></span>"
					}), a.attr("class", d).html(c), this.api.render(this.lvMap, this.lv)
				}
			},
			renderInfo: function() {
					if(this.lv==0){
						lvtype="数字"
						answer="答案是：3"
					}else if(this.lv==1){
						lvtype="图形"
						answer="答案是：三角形"
					}else if(this.lv==2){
						lvtype="文字"
						answer="答案是：叁"
					}else if(this.lv==3){
						lvtype="文字"
						answer="弓"
					}else if(this.lv==4){
						lvtype="语言"
						answer="yichi ni san yon"
					}else if(this.lv==5){
						lvtype="历史"
						answer="答案是：唐三藏"
					}else if(this.lv==6){
						lvtype="音乐"
						answer="duo rui mi"
					}else if(this.lv==7){
						lvtype="动漫"
						answer="答案是：三井寿"
					}else if(this.lv==8){
						lvtype="游戏"
						answer="答案是：剑三"
					}else if(this.lv==9){
						lvtype="品牌"
						answer="答案是：三星"
					}else if(this.lv==10){
						lvtype="八卦"
						answer="答案是：姚笛"
					}else if(this.lv==11){
						lvtype="饮食"
						answer="答案是：三明治"
					}else if(this.lv==12){
						lvtype="健康"
						answer="答案是：三鹿"
					}else if(this.lv==13){
						lvtype="消费"
						answer="答案是：支付宝（第三方支付）"
					}else if(this.lv==14){
						lvtype="时事"
						answer="答案是：江泽民（中国第三代领导人）"
					}
				b.lv.text("第 "+(this.lv + 1)+" 关")
				b.lvtype.text(lvtype)
				curlv = this.lv;
			},
			gameOver: function() {
				try {
					WeixinJSBridge.call("showOptionMenu")
				} catch (c) {}
				var d = this.api.getGameOverText(this.lv);
				this.lastLv = this.lv, this.lastGameTxt = d.txt, this.lastGamePercent = d.percent, b.d_content.hide(), b.d_gameover.show().find("h3").text("你是"+this.lastGameTxt), b.d_gameover.show().find("h2").eq(0).text(answer), b.d_gameover.show().find("h2").eq(1).text(say), b.d_gameover.show().find("h2").eq(1).css("display","none"), a.find("span").fadeOut(1500, function() {
					b.dialog.show()
					
				}), this._pause = !0, this.reset(), _hmt.push(["_trackEvent", "游戏结束", this.lv + 1])
			},
			reset: function() {
				this.time = this.config.allTime, this.lv = -1
			},
			nextLv: function() {

				if(this.lv==14){
					this.gameOver();
				}else{
				this.time += this.config.addTime, b.time.text(parseInt(this.time)), this._pause || this.start()
				}
			},
			back: function() {
				this._pause = !0, this.el.hide(), b.dialog.hide(), this.parent.render()
			}
		};
	window.Game = c
}(), function(a) {
	var b = {
		index: $("#index"),
		room: $("#room"),
		loading: $("#loading"),
		dialog: $("#dialog"),
		play: $(".play-btn"),
		btn_boyaa: $(".btn-boyaa"),
		banner: $(".banner"),
		boyaa_logo: $(".boyaa-logo")
	},
		c = window.navigator.userAgent.toLowerCase(),
		d = {
			init: function() {
				this.initEvent(), this.loading(), /android/i.test(c) ? (b.banner.attr("href", "http://a.app.qq.com/o/simple.jsp?pkgname=com.byddz.engineddz.ddzad").find("img").attr("src", "assets/img/banner.android.jpg"), b.banner.show()) : /iphone|ipad|ipod/i.test(c) && (b.banner.attr("href", "http://a.app.qq.com/o/simple.jsp?pkgname=com.boyaa.lordland.ddzad").find("img").attr("src", "assets/img/banner.ios.jpg"), b.banner.show())
			},
			loading: function() {
				function a() {
					e++, e == c && d.render()
				}
				d.render();
				document.addEventListener("WeixinJSBridgeReady", function() {
					WeixinJSBridge && (WeixinJSBridge.on("menu:share:appmessage", function() {
						var a = Game.lastLv > 0 ? "成功抓住一个小三，我闯过" + (Game.lastLv + 1) + "关，我的小三是凤姐。。。快来找你的小三" : shareData.tTitle;
						WeixinJSBridge.invoke("sendAppMessage", {
							img_url: shareData.imgUrl,
							link: shareData.timeLineLink,
							desc: shareData.tContent,
							title: a
						}, function() {
							_hmt.push(["_trackEvent", "分享", "好友"])
						})
					}), WeixinJSBridge.on("menu:share:timeline", function() {
						var a = Game.lastLv > 0 ? "成功抓住一个小三，我闯过" + (Game.lastLv + 1) + "关，我的小三是凤姐。。。快来找你的小三" : shareData.tTitle;
						WeixinJSBridge.invoke("shareTimeline", {
							img_url: shareData.imgUrl,
							img_width: "640",
							img_height: "640",
							link: shareData.timeLineLink,
							desc: shareData.tContent,
							title: a
						}, function() {
							_hmt.push(["_trackEvent", "分享", "朋友圈"])
						})
					}))
				}, !1)
			},
			render: function() {
				b.loading.hide(), b.index.show()
			},
			initEvent: function() {
				var a = "ontouchstart" in document.documentElement ? "touchstart" : "click",
					c = this;
				b.play.on(a, function() {
					var a = $(this).data("type") || "color";
					b.index.hide(), Game.init(a, b.room, c)
				}), b.btn_boyaa.on(a, function() {
					 //_hmt.push(["_trackEvent", "游戏弹窗", "更多游戏"])
				}), b.boyaa_logo.on(a, function() {
					//_hmt.push(["_trackEvent", "游戏弹窗", "博雅logo"])
				}), b.banner.on(a, function() {
					//_hmt.push(["_trackEvent", "游戏弹窗", "banner"])
				})
			}
		};
	d.init(), a.API = {}
}(window), function() {
	var a = $("#box"),
		b = "span",
		c = $("#help p"),
		d = $("#help_color"),
		e = {
			lvT: ["屌丝", "屌丝","屌丝", "屌丝", "屌丝", "独具慧眼", "独具慧眼", "独具慧眼", "独具慧眼"],
			render: function(e, f) {
				this.lv = f, c.hide(), d.show();
				var g = _config.color.lvMap[f] || _.last(_config.color.lvMap);
				this.d = 15 * Math.max(9 - g, 1), this.d = f > 20 ? 10 : this.d, this.d = f > 40 ? 8 : this.d, this.d = f > 50 ? 5 : this.d;
				var h = Math.floor(Math.random() * e * e),
					  i = this.getColor(255 - this.d),
					  j = this.getLvColor(i[0]),
					  wrongmessage,
					  t;
					  
				function getArrayItems(arr, num) {
    				var temp_array = new Array();
    				for (var index in arr) {
        				temp_array.push(arr[index]);
   					}
				}
				
					
				if(this.lv<=8){
					 temp_array = ['1', '2', '3', '4', '5', '6', '7', '8', '9'];
					 t = 9;
				}else if(this.lv>8){
					 temp_array = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16'];
					 t = 16;
				}
					 
				if(this.lv<4){
					 gameoverpic = "gameoverlv1"
					 say = "这是你的小三，还不错吧"
				}else if(this.lv>3&&this.lv<7){
					 gameoverpic = "gameoverlv2"
					 say = "看来芙容是你的菜"
				}else if(this.lv>6&&this.lv<10){
					gameoverpic = "gameoverlv3"
					 say = "你是我的小呀小苹果～"
				}else if(this.lv>9&&this.lv<13){
					gameoverpic = "gameoverlv4"
					 say = "哇，不错噢"
				}else if(this.lv>12&&this.lv<16){
					gameoverpic = "gameoverlv5"
					 say = "恭喜恭喜，后宫佳丽三千"
				}
					 
				for(var m=0;m<t;m++){
					var arrIndex = Math.floor(Math.random()*temp_array.length);
					a.find(b).eq(m).css("background","url(assets/img/"+(this.lv+1)+"/"+temp_array[arrIndex]+".jpg)"), a.find(b).css("background-size","100%");
					//alert(temp_array.length+"||"+temp_array);
					temp_array.splice(arrIndex, 1);
					
				}
				
				a.find(b).eq(h).css("background","url(assets/img/"+(this.lv+1)+"/0.jpg)"),a.find(b).eq(h).css("background-size","100%")
				a.find(b).css("background-color", "#fff"), a.find(b).eq(h).data("type", "a")
				//a.find(b).css("background-color", i[1]).data("type", "b"), a.find(b).eq(h).css("background-color", j[1]).data("type", "a")
				
				a.find(b).click(function(){				
					if($(this).index()!=h){
						//alert(wrongmessage);
					}
				});
				
				if(tips>0){
					$(".magnifier").removeClass("dismis "); 
				}
				fdj = a.find(b).eq(h);
								
			},
			getColor: function(a) {
				var b = [Math.round(Math.random() * a), Math.round(Math.random() * a), Math.round(Math.random() * a)],
					c = "rgb(" + b.join(",") + ")";
				return [b, c]
			},
			getLvColor: function(a) {
				var b = this.d,
					c = _.map(a, function(a) {
						return a + b
					}),
					d = "rgb(" + c.join(",") + ")";
				return [c, d]
			},
			getGameOverText: function(a) {
				var b = 15 > a ? 0 : Math.ceil((a - 15) / 5),
					c = this.lvT[b] || _.last(this.lvT),
					d = c + "lv" + (a + 1),
					e = 2 * a;
				return e = e > 90 ? 90 + .15 * a : e, e = Math.min(e, 100), {
					txt: d,
					percent: e
				}
			}
			
		};
		
	API.color = e
}();

$(".magnifier").click(function(){ 
					if(tips>0){
						$(this).addClass("dismis "); 
						fdj.append("<div></div>")
						document.querySelector('#box span div').addEventListener("webkitAnimationEnd", function(){
							$("#box span").empty();
						})
						tips=tips-1;
					}else{
						alert("没提示了噢，亲")	
					}
				});


$(".boyaa-logo").click(function(){ 
		$(".boyaa-logo").css("background","url(assets/img/"+gameoverpic+".jpg)");
		$(".boyaa-logo").css("background-size","100%");
		$(".boyaa-logo span").empty();
		$(".inner-content").find("h2").eq(1).css("display","block");
		if(curlv>9){
				document.getElementById("sd_win").play(); 
		}else{
				document.getElementById("sd_los").play(); 
		}
});
